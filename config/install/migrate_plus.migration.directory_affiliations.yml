id: directory_affiliations
label: 'Migrating directory affiliations from JSON file'
migration_group: directory

source:
  plugin: url
  data_fetcher_plugin: file
  data_parser_plugin: json
  urls: 'public://migrations/directory/directory_affiliations.json'
  item_selector: /
  fields:
    -
      name: parent_id
      selector: parent_id
    -
      name: pg
      selector: pg
    -
      name: affiliation_type
      selector: affiliation_type
    -
      name: discipline
      selector: discipline
    -
      name: year_start
      selector: year_start
  ids:
    pg:
      type: integer

process:
  field_pg:
    plugin: get
    source: pg
  field_affil_type:
    plugin: entity_lookup
    source: affiliation_type
    entity_type: taxonomy_term
    bundle_key: vid
    bundle: affiliation_types
    value_key: name
    ignore_case: true
  field_affil_discipline:
    plugin: entity_lookup
    source: discipline
    entity_type: taxonomy_term
    bundle_key: vid
    bundle: disciplines
    value_key: name
    ignore_case: true

destination:
  plugin: 'entity_reference_revisions:paragraph'
  default_bundle: 'affiliation'
